
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../math/">
      
      
        <link rel="next" href="../handeye/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>API - Robo Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Robo Docs" class="md-header__button md-logo" aria-label="Robo Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Robo Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Robo Docs" class="md-nav__button md-logo" aria-label="Robo Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Robo Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../math/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mathematical Details
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#packages" class="md-nav__link">
    <span class="md-ellipsis">
      Packages
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calibration" class="md-nav__link">
    <span class="md-ellipsis">
      calibration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calibration.HandEyeComparison" class="md-nav__link">
    <span class="md-ellipsis">
      HandEyeComparison
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#robot" class="md-nav__link">
    <span class="md-ellipsis">
      robot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision" class="md-nav__link">
    <span class="md-ellipsis">
      vision
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision.CameraBase" class="md-nav__link">
    <span class="md-ellipsis">
      CameraBase
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CameraBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision.CameraBase.get_frames" class="md-nav__link">
    <span class="md-ellipsis">
      get_frames
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.CameraBase.start" class="md-nav__link">
    <span class="md-ellipsis">
      start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.CameraBase.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision.CloudAnalyzer" class="md-nav__link">
    <span class="md-ellipsis">
      CloudAnalyzer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision.PointCloudBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      PointCloudBuilder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      PointCloudGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PointCloudGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.depth_to_cloud" class="md-nav__link">
    <span class="md-ellipsis">
      depth_to_cloud
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.downsample_cloud" class="md-nav__link">
    <span class="md-ellipsis">
      downsample_cloud
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.filter_cloud" class="md-nav__link">
    <span class="md-ellipsis">
      filter_cloud
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.icp_pairwise_align" class="md-nav__link">
    <span class="md-ellipsis">
      icp_pairwise_align
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.load_ply" class="md-nav__link">
    <span class="md-ellipsis">
      load_ply
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.merge_clouds" class="md-nav__link">
    <span class="md-ellipsis">
      merge_clouds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.pose_to_transform" class="md-nav__link">
    <span class="md-ellipsis">
      pose_to_transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.save_ply" class="md-nav__link">
    <span class="md-ellipsis">
      save_ply
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.visualize" class="md-nav__link">
    <span class="md-ellipsis">
      visualize
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision.RGBDAggregator" class="md-nav__link">
    <span class="md-ellipsis">
      RGBDAggregator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RGBDAggregator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision.RGBDAggregator.aggregate" class="md-nav__link">
    <span class="md-ellipsis">
      aggregate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision.RealSenseD415" class="md-nav__link">
    <span class="md-ellipsis">
      RealSenseD415
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RealSenseD415">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.get_frames" class="md-nav__link">
    <span class="md-ellipsis">
      get_frames
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_frames">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.get_frames--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.get_frames--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.set_projector" class="md-nav__link">
    <span class="md-ellipsis">
      set_projector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.start" class="md-nav__link">
    <span class="md-ellipsis">
      start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.D415_Cfg" class="md-nav__link">
    <span class="md-ellipsis">
      D415_Cfg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.GridCalibCfg" class="md-nav__link">
    <span class="md-ellipsis">
      GridCalibCfg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.HandEyeCfg" class="md-nav__link">
    <span class="md-ellipsis">
      HandEyeCfg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.JSONPoseLoader" class="md-nav__link">
    <span class="md-ellipsis">
      JSONPoseLoader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JSONPoseLoader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#utils.JSONPoseLoader.load_poses" class="md-nav__link">
    <span class="md-ellipsis">
      load_poses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.Logger" class="md-nav__link">
    <span class="md-ellipsis">
      Logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#utils.Logger.configure" class="md-nav__link">
    <span class="md-ellipsis">
      configure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utils.Logger.configure_root_logger" class="md-nav__link">
    <span class="md-ellipsis">
      configure_root_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utils.Logger.get_logger" class="md-nav__link">
    <span class="md-ellipsis">
      get_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utils.Logger.progress" class="md-nav__link">
    <span class="md-ellipsis">
      progress
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.TransformUtils" class="md-nav__link">
    <span class="md-ellipsis">
      TransformUtils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.decompose_transform" class="md-nav__link">
    <span class="md-ellipsis">
      decompose_transform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.euler_to_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      euler_to_matrix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.invert_transform" class="md-nav__link">
    <span class="md-ellipsis">
      invert_transform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.load_camera_params" class="md-nav__link">
    <span class="md-ellipsis">
      load_camera_params
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.load_json" class="md-nav__link">
    <span class="md-ellipsis">
      load_json
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.load_npy" class="md-nav__link">
    <span class="md-ellipsis">
      load_npy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.make_transform" class="md-nav__link">
    <span class="md-ellipsis">
      make_transform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.read_image" class="md-nav__link">
    <span class="md-ellipsis">
      read_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.save_camera_params_txt" class="md-nav__link">
    <span class="md-ellipsis">
      save_camera_params_txt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.save_camera_params_xml" class="md-nav__link">
    <span class="md-ellipsis">
      save_camera_params_xml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.save_json" class="md-nav__link">
    <span class="md-ellipsis">
      save_json
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.save_npy" class="md-nav__link">
    <span class="md-ellipsis">
      save_npy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.write_image" class="md-nav__link">
    <span class="md-ellipsis">
      write_image
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../handeye/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HANDEYE
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#packages" class="md-nav__link">
    <span class="md-ellipsis">
      Packages
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calibration" class="md-nav__link">
    <span class="md-ellipsis">
      calibration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calibration.HandEyeComparison" class="md-nav__link">
    <span class="md-ellipsis">
      HandEyeComparison
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#robot" class="md-nav__link">
    <span class="md-ellipsis">
      robot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision" class="md-nav__link">
    <span class="md-ellipsis">
      vision
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision.CameraBase" class="md-nav__link">
    <span class="md-ellipsis">
      CameraBase
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CameraBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision.CameraBase.get_frames" class="md-nav__link">
    <span class="md-ellipsis">
      get_frames
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.CameraBase.start" class="md-nav__link">
    <span class="md-ellipsis">
      start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.CameraBase.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision.CloudAnalyzer" class="md-nav__link">
    <span class="md-ellipsis">
      CloudAnalyzer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision.PointCloudBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      PointCloudBuilder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      PointCloudGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PointCloudGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.depth_to_cloud" class="md-nav__link">
    <span class="md-ellipsis">
      depth_to_cloud
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.downsample_cloud" class="md-nav__link">
    <span class="md-ellipsis">
      downsample_cloud
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.filter_cloud" class="md-nav__link">
    <span class="md-ellipsis">
      filter_cloud
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.icp_pairwise_align" class="md-nav__link">
    <span class="md-ellipsis">
      icp_pairwise_align
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.load_ply" class="md-nav__link">
    <span class="md-ellipsis">
      load_ply
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.merge_clouds" class="md-nav__link">
    <span class="md-ellipsis">
      merge_clouds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.pose_to_transform" class="md-nav__link">
    <span class="md-ellipsis">
      pose_to_transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.save_ply" class="md-nav__link">
    <span class="md-ellipsis">
      save_ply
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.PointCloudGenerator.visualize" class="md-nav__link">
    <span class="md-ellipsis">
      visualize
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision.RGBDAggregator" class="md-nav__link">
    <span class="md-ellipsis">
      RGBDAggregator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RGBDAggregator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision.RGBDAggregator.aggregate" class="md-nav__link">
    <span class="md-ellipsis">
      aggregate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vision.RealSenseD415" class="md-nav__link">
    <span class="md-ellipsis">
      RealSenseD415
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RealSenseD415">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.get_frames" class="md-nav__link">
    <span class="md-ellipsis">
      get_frames
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_frames">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.get_frames--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.get_frames--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.set_projector" class="md-nav__link">
    <span class="md-ellipsis">
      set_projector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.start" class="md-nav__link">
    <span class="md-ellipsis">
      start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision.RealSenseD415.stop" class="md-nav__link">
    <span class="md-ellipsis">
      stop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.D415_Cfg" class="md-nav__link">
    <span class="md-ellipsis">
      D415_Cfg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.GridCalibCfg" class="md-nav__link">
    <span class="md-ellipsis">
      GridCalibCfg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.HandEyeCfg" class="md-nav__link">
    <span class="md-ellipsis">
      HandEyeCfg
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.JSONPoseLoader" class="md-nav__link">
    <span class="md-ellipsis">
      JSONPoseLoader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JSONPoseLoader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#utils.JSONPoseLoader.load_poses" class="md-nav__link">
    <span class="md-ellipsis">
      load_poses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.Logger" class="md-nav__link">
    <span class="md-ellipsis">
      Logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#utils.Logger.configure" class="md-nav__link">
    <span class="md-ellipsis">
      configure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utils.Logger.configure_root_logger" class="md-nav__link">
    <span class="md-ellipsis">
      configure_root_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utils.Logger.get_logger" class="md-nav__link">
    <span class="md-ellipsis">
      get_logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utils.Logger.progress" class="md-nav__link">
    <span class="md-ellipsis">
      progress
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.TransformUtils" class="md-nav__link">
    <span class="md-ellipsis">
      TransformUtils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.decompose_transform" class="md-nav__link">
    <span class="md-ellipsis">
      decompose_transform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.euler_to_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      euler_to_matrix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.invert_transform" class="md-nav__link">
    <span class="md-ellipsis">
      invert_transform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.load_camera_params" class="md-nav__link">
    <span class="md-ellipsis">
      load_camera_params
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.load_json" class="md-nav__link">
    <span class="md-ellipsis">
      load_json
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.load_npy" class="md-nav__link">
    <span class="md-ellipsis">
      load_npy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.make_transform" class="md-nav__link">
    <span class="md-ellipsis">
      make_transform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.read_image" class="md-nav__link">
    <span class="md-ellipsis">
      read_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.save_camera_params_txt" class="md-nav__link">
    <span class="md-ellipsis">
      save_camera_params_txt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.save_camera_params_xml" class="md-nav__link">
    <span class="md-ellipsis">
      save_camera_params_xml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.save_json" class="md-nav__link">
    <span class="md-ellipsis">
      save_json
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.save_npy" class="md-nav__link">
    <span class="md-ellipsis">
      save_npy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils.write_image" class="md-nav__link">
    <span class="md-ellipsis">
      write_image
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="api-reference">API Reference</h1>
<p>The full Python API is generated from typeâ€‘hints and docstrings using <strong>mkdocstrings</strong>. Use the module links below to explore each package.</p>
<h2 id="packages">Packages</h2>
<ul>
<li><a href="../calibration"><code>calibration</code></a></li>
<li><a href="../robot"><code>robot</code></a></li>
<li><a href="../vision"><code>vision</code></a></li>
<li><a href="../utils"><code>utils</code></a></li>
</ul>


<div class="doc doc-object doc-module">



<a id="calibration"></a>
    <div class="doc doc-contents first">

        <p>Robotics calibration package.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="calibration.HandEyeComparison" class="doc doc-heading">
            <code>HandEyeComparison</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Run hand-eye calibration for several pose estimation variants.</p>







              <details class="quote">
                <summary>Source code in <code>calibration/comparison.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HandEyeComparison</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run hand-eye calibration for several pose estimation variants.&quot;&quot;&quot;</span>

    <span class="n">visualize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerType</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">Logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;calibration.comparison&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pose_pnp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">K</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">dist</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping PnP: only </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> correspondences&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">solve_pnp_obj_to_img</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pose_svd</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">meas</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Estimate pose by aligning two 3-D point sets.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rigid_transform_3D</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">meas</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover - numerical issues</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVD failed: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_depth_points</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">corners</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">depth</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">K_rgb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">K_depth</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">R_c2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">EXTR_COLOR_TO_DEPTH_ROT</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">t_c2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">EXTR_COLOR_TO_DEPTH_TRANS</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">R_d2c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">EXTR_DEPTH_TO_COLOR_ROT</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">t_d2c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">EXTR_DEPTH_TO_COLOR_TRANS</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;[_depth_points] Input: corners shape=</span><span class="si">{</span><span class="n">corners</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, depth shape=</span><span class="si">{</span><span class="n">depth</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[_depth_points] K_rgb:</span><span class="se">\n</span><span class="si">{</span><span class="n">K_rgb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[_depth_points] K_depth:</span><span class="se">\n</span><span class="si">{</span><span class="n">K_depth</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[_depth_points] Extrinsics R_d2c:</span><span class="se">\n</span><span class="si">{</span><span class="n">R_d2c</span><span class="si">}</span><span class="se">\n</span><span class="s2"> t_d2c:</span><span class="si">{</span><span class="n">t_d2c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">pts_3d</span> <span class="o">=</span> <span class="n">get_3d_points_from_depth</span><span class="p">(</span>
            <span class="n">corners</span><span class="p">,</span>
            <span class="n">depth</span><span class="p">,</span>
            <span class="n">K_rgb</span><span class="p">,</span>
            <span class="n">K_depth</span><span class="p">,</span>
            <span class="n">R_c2d</span><span class="p">,</span>
            <span class="n">R_d2c</span><span class="p">,</span>
            <span class="n">t_c2d</span><span class="p">,</span>
            <span class="n">t_d2c</span><span class="p">,</span>
            <span class="n">depth_scale</span><span class="o">=</span><span class="n">DEPTH_SCALE</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;[_depth_points] Output: 3D points shape=</span><span class="si">{</span><span class="n">pts_3d</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;sample: </span><span class="si">{</span><span class="n">pts_3d</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">pts_3d</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_camera_poses</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">robot_Rs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">robot_ts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">R</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">invert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
        <span class="n">cam_Rs</span><span class="p">,</span> <span class="n">cam_ts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">T_tool</span> <span class="o">=</span> <span class="n">TransformUtils</span><span class="o">.</span><span class="n">build_transform</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">T_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">T_tool</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">Rg</span><span class="p">,</span> <span class="n">tg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">robot_Rs</span><span class="p">,</span> <span class="n">robot_ts</span><span class="p">):</span>
            <span class="n">T_base</span> <span class="o">=</span> <span class="n">TransformUtils</span><span class="o">.</span><span class="n">build_transform</span><span class="p">(</span><span class="n">Rg</span><span class="p">,</span> <span class="n">tg</span><span class="p">)</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">T_tool</span> <span class="o">@</span> <span class="n">T_base</span> <span class="k">if</span> <span class="n">invert</span> <span class="k">else</span> <span class="n">T_base</span> <span class="o">@</span> <span class="n">T_inv</span>
            <span class="n">cam_Rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">cam_ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cam_Rs</span><span class="p">,</span> <span class="n">cam_ts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_run_method</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">robot_Rs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">robot_ts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">target_Rs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">target_ts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">out_base</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">robot_Rs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_Rs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Skipping </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> â€” too few pose pairs: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">robot_Rs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">R</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_Rs</span><span class="p">):</span>
            <span class="n">det</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;target_R[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] has near-zero determinant: </span><span class="si">{</span><span class="n">det</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="k">with</span> <span class="n">CaptureStderrToLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">R_ct</span><span class="p">,</span> <span class="n">t_ct</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calibrateHandEye</span><span class="p">(</span>
                    <span class="n">robot_Rs</span><span class="p">,</span> <span class="n">robot_ts</span><span class="p">,</span> <span class="n">target_Rs</span><span class="p">,</span> <span class="n">target_ts</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">cv2</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># gracefully skip</span>

        <span class="n">out_base</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">save_transform</span><span class="p">(</span><span class="n">out_base</span> <span class="o">/</span> <span class="n">name</span><span class="p">,</span> <span class="n">TransformUtils</span><span class="o">.</span><span class="n">build_transform</span><span class="p">(</span><span class="n">R_ct</span><span class="p">,</span> <span class="n">t_ct</span><span class="p">))</span>
        <span class="n">cam_Rs</span><span class="p">,</span> <span class="n">cam_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_camera_poses</span><span class="p">(</span><span class="n">robot_Rs</span><span class="p">,</span> <span class="n">robot_ts</span><span class="p">,</span> <span class="n">R_ct</span><span class="p">,</span> <span class="n">t_ct</span><span class="p">)</span>
        <span class="n">robot_Rss</span><span class="p">,</span> <span class="n">robot_tss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_camera_poses</span><span class="p">(</span><span class="n">robot_Rs</span><span class="p">,</span> <span class="n">robot_ts</span><span class="p">,</span> <span class="n">R_ct</span><span class="p">,</span> <span class="n">t_ct</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">rot_err</span><span class="p">,</span> <span class="n">trans_err</span> <span class="o">=</span> <span class="n">handeye_errors</span><span class="p">(</span>
            <span class="n">robot_Rs</span><span class="p">,</span> <span class="n">robot_ts</span><span class="p">,</span> <span class="n">target_Rs</span><span class="p">,</span> <span class="n">target_ts</span><span class="p">,</span> <span class="n">R_ct</span><span class="p">,</span> <span class="n">t_ct</span>
        <span class="p">)</span>
        <span class="n">t_rmse</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trans_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">r_rmse</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rot_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">robot_tss</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cam_ts</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="p">[</span><span class="n">rotation_angle</span><span class="p">(</span><span class="n">Rr</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Rc</span><span class="p">)</span> <span class="k">for</span> <span class="n">Rr</span><span class="p">,</span> <span class="n">Rc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">robot_Rss</span><span class="p">,</span> <span class="n">cam_Rs</span><span class="p">)]</span>
        <span class="n">a_t_rmse</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trans</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">a_r_rmse</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">rot</span><span class="p">))))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualize</span><span class="p">:</span>
            <span class="n">plot_file</span> <span class="o">=</span> <span class="n">paths</span><span class="o">.</span><span class="n">VIZ_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_base</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_poses.png&quot;</span>
            <span class="n">plot_poses</span><span class="p">(</span><span class="n">robot_Rs</span><span class="p">,</span> <span class="n">robot_ts</span><span class="p">,</span> <span class="n">cam_Rs</span><span class="p">,</span> <span class="n">cam_ts</span><span class="p">,</span> <span class="n">plot_file</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">t_rmse</span><span class="p">,</span> <span class="n">r_rmse</span><span class="p">,</span> <span class="n">a_t_rmse</span><span class="p">,</span> <span class="n">a_r_rmse</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_log_summary</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">summary</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">out_dir</span><span class="p">:</span> <span class="n">Path</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Summary of hand-eye calibration and pose alignment errors:&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Method     | T. RMSE [m] | R. RMSE [deg] | Align T. RMSE [m] | Align R. RMSE [deg]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-----------|-------------|---------------|-------------------|-------------------&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">r2</span> <span class="ow">in</span> <span class="n">summary</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> |  </span><span class="si">{</span><span class="n">t1</span><span class="si">:</span><span class="s2">&gt;9.6f</span><span class="si">}</span><span class="s2">  |  </span><span class="si">{</span><span class="n">r1</span><span class="si">:</span><span class="s2">&gt;11.4f</span><span class="si">}</span><span class="s2">  |  </span><span class="si">{</span><span class="n">t2</span><span class="si">:</span><span class="s2">&gt;15.6f</span><span class="si">}</span><span class="s2">  |  </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">&gt;17.4f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results saved to </span><span class="si">{</span><span class="n">out_dir</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_collect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">CalibrationPattern</span><span class="p">,</span>
        <span class="n">intrinsics</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">robot_Rs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">robot_ts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]]:</span>
        <span class="n">K_rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">INTRINSICS_COLOR_MATRIX</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="mf">0.14276977476919803</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">0.37253190781644513</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">0.002400175306122351</span><span class="p">,</span>
                <span class="mf">0.005829250084910286</span><span class="p">,</span>
                <span class="mf">0.23582308984644337</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">K_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">INTRINSICS_DEPTH_MATRIX</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">variants</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;pnp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;robot_Rs&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;robot_ts&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="p">[]},</span>
            <span class="s2">&quot;svd&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;robot_Rs&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;robot_ts&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="p">[]},</span>
            <span class="s2">&quot;pnp_depth&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;robot_Rs&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;robot_ts&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="p">[]},</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">img_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Logger</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;detect&quot;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">robot_Rs</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">img_path</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">detection</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">detection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">corners</span>  <span class="c1"># Nx2</span>
            <span class="n">object_points</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">object_points</span>
            <span class="n">depth_file</span> <span class="o">=</span> <span class="n">img_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="n">DEPTH_EXT</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">depth_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">load_depth</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">depth_file</span><span class="p">))</span>
            <span class="c1"># get 3d points, order the same as detection.corners/object_points</span>
            <span class="n">depth_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depth_points</span><span class="p">(</span><span class="n">detection</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">K_rgb</span><span class="p">,</span> <span class="n">K_depth</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">depth_pts</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># align pairs</span>
            <span class="n">corners_valid</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>  <span class="c1"># Nx2</span>
            <span class="n">object_points_valid</span> <span class="o">=</span> <span class="n">object_points</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>  <span class="c1"># Nx3</span>
            <span class="n">depth_pts_valid</span> <span class="o">=</span> <span class="n">depth_pts</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>  <span class="c1"># Nx3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">img_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] First valid point: corner RGB=</span><span class="si">{</span><span class="n">corners_valid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;object_point=</span><span class="si">{</span><span class="n">object_points_valid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, depth_3d=</span><span class="si">{</span><span class="n">depth_pts_valid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">corners_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">object_points_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="ow">or</span> <span class="n">corners_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">depth_pts_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Corner/depth correspondence mismatch&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">img_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] valid points: </span><span class="si">{</span><span class="n">corners_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="c1"># 2D-3D PnP</span>
            <span class="n">R_pnp2d</span><span class="p">,</span> <span class="n">t_pnp2d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pose_pnp</span><span class="p">(</span>
                <span class="n">object_points_valid</span><span class="p">,</span> <span class="n">corners_valid</span><span class="p">,</span> <span class="n">K_rgb</span><span class="p">,</span> <span class="n">dist</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">R_pnp2d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">t_pnp2d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">object_points_in_rgb</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">R_pnp2d</span> <span class="o">@</span> <span class="n">object_points_valid</span><span class="o">.</span><span class="n">T</span>
                <span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">t_pnp2d</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[PnP] Transformed first object point to RGB: </span><span class="si">{</span><span class="n">object_points_in_rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">variants</span><span class="p">[</span><span class="s2">&quot;pnp&quot;</span><span class="p">][</span><span class="s2">&quot;robot_Rs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot_Rs</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="n">variants</span><span class="p">[</span><span class="s2">&quot;pnp&quot;</span><span class="p">][</span><span class="s2">&quot;robot_ts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot_ts</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="n">variants</span><span class="p">[</span><span class="s2">&quot;pnp&quot;</span><span class="p">][</span><span class="s2">&quot;R&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R_pnp2d</span><span class="p">)</span>
                <span class="n">variants</span><span class="p">[</span><span class="s2">&quot;pnp&quot;</span><span class="p">][</span><span class="s2">&quot;t&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_pnp2d</span><span class="p">)</span>

                <span class="c1"># SVD 3D-3D: object_points_in_rgb to depth_pts_valid with mask</span>
                <span class="n">pose_svd</span> <span class="o">=</span> <span class="n">rigid_transform_3D</span><span class="p">(</span><span class="n">object_points_valid</span><span class="p">,</span> <span class="n">depth_pts_valid</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">pose_svd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">pose_svd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">pose_svd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="n">variants</span><span class="p">[</span><span class="s2">&quot;svd&quot;</span><span class="p">][</span><span class="s2">&quot;robot_Rs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot_Rs</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="n">variants</span><span class="p">[</span><span class="s2">&quot;svd&quot;</span><span class="p">][</span><span class="s2">&quot;robot_ts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot_ts</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="n">variants</span><span class="p">[</span><span class="s2">&quot;svd&quot;</span><span class="p">][</span><span class="s2">&quot;R&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pose_svd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">variants</span><span class="p">[</span><span class="s2">&quot;svd&quot;</span><span class="p">][</span><span class="s2">&quot;t&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pose_svd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="n">pose_pd</span> <span class="o">=</span> <span class="n">solve_pnp_obj_to_3d</span><span class="p">(</span><span class="n">depth_pts_valid</span><span class="p">,</span> <span class="n">object_points_valid</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">pose_pd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">pose_pd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">pose_pd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="n">variants</span><span class="p">[</span><span class="s2">&quot;pnp_depth&quot;</span><span class="p">][</span><span class="s2">&quot;robot_Rs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot_Rs</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="n">variants</span><span class="p">[</span><span class="s2">&quot;pnp_depth&quot;</span><span class="p">][</span><span class="s2">&quot;robot_ts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot_ts</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="n">variants</span><span class="p">[</span><span class="s2">&quot;pnp_depth&quot;</span><span class="p">][</span><span class="s2">&quot;R&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pose_pd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">variants</span><span class="p">[</span><span class="s2">&quot;pnp_depth&quot;</span><span class="p">][</span><span class="s2">&quot;t&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pose_pd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">variants</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calibrate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">poses_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">CalibrationPattern</span><span class="p">,</span>
        <span class="n">intrinsics</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting hand-eye comparison&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">robot_Rs</span><span class="p">,</span> <span class="n">robot_ts</span> <span class="o">=</span> <span class="n">JSONPoseLoader</span><span class="o">.</span><span class="n">load_poses</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">poses_file</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">intrinsics</span><span class="p">,</span> <span class="n">robot_Rs</span><span class="p">,</span> <span class="n">robot_ts</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">variant</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No valid poses for </span><span class="si">{</span><span class="n">variant</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">out_base</span> <span class="o">=</span> <span class="n">paths</span><span class="o">.</span><span class="n">RESULTS_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;handeye_</span><span class="si">{</span><span class="n">variant</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">summary</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">HAND_EYE_METHODS</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">variant</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_method</span><span class="p">(</span>
                        <span class="n">m</span><span class="p">,</span>
                        <span class="n">name</span><span class="p">,</span>
                        <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;robot_Rs&quot;</span><span class="p">],</span>
                        <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;robot_ts&quot;</span><span class="p">],</span>
                        <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">],</span>
                        <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">],</span>
                        <span class="n">out_base</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_summary</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="n">out_base</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hand-eye comparison failed: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ErrorTracker</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">pattern</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="robot"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="vision"></a>
    <div class="doc doc-contents first">

        <p>Camera interfaces and 3D vision helpers.</p>
<p>The vision package contains camera drivers, point cloud tools and transformation
utilities used throughout the robotics stack.  Open3D and OpenCV are leveraged
to convert depth images to point clouds, apply filters and perform coordinate
transforms.  Subpackages provide reusable components that can be combined in
custom pipelines or accessed through the provided CLI tools.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="vision.CameraBase" class="doc doc-heading">
            <code>CameraBase</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Minimal camera control API.</p>







              <details class="quote">
                <summary>Source code in <code>vision/camera/camera_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CameraBase</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Minimal camera control API.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start streaming.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop streaming.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_frames</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">aligned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return color and depth frames.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="vision.CameraBase.get_frames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_frames</span><span class="p">(</span><span class="n">aligned</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return color and depth frames.</p>


            <details class="quote">
              <summary>Source code in <code>vision/camera/camera_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_frames</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">aligned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return color and depth frames.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.CameraBase.start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Start streaming.</p>


            <details class="quote">
              <summary>Source code in <code>vision/camera/camera_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Start streaming.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.CameraBase.stop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stop</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Stop streaming.</p>


            <details class="quote">
              <summary>Source code in <code>vision/camera/camera_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stop streaming.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="vision.CloudAnalyzer" class="doc doc-heading">
            <code>CloudAnalyzer</code>


</h2>


    <div class="doc doc-contents ">


        <p>Full visualization and analysis pipeline.</p>







              <details class="quote">
                <summary>Source code in <code>vision/pointcloud/analyzer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CloudAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Full visualization and analysis pipeline.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="n">Logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;vision.pipeline&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">denoiser</span> <span class="o">=</span> <span class="n">PointCloudDenoiser</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cropper</span> <span class="o">=</span> <span class="n">PointCloudCropper</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clusterer</span> <span class="o">=</span> <span class="n">PointCloudClusterer</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="o">=</span> <span class="n">ObjectSurfaceAnalyzer</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topfinder</span> <span class="o">=</span> <span class="n">TopFaceFinder</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory_planner</span> <span class="o">=</span> <span class="n">TopFaceTrajectoryPlanner</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_ply</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">input_ply</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">input_ply</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pcd</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2"> points&quot;</span><span class="p">)</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries_with_editing</span><span class="p">([</span><span class="n">pcd</span><span class="p">],</span> <span class="n">window_name</span><span class="o">=</span><span class="s2">&quot;Raw cloud&quot;</span><span class="p">)</span>

        <span class="n">cropped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cropper</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
        <span class="c1"># o3d.visualization.draw_geometries_with_editing(</span>
        <span class="c1">#     [cropped], window_name=&quot;Cropped cloud&quot;</span>
        <span class="c1"># )</span>

        <span class="n">clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoiser</span><span class="o">.</span><span class="n">denoise</span><span class="p">(</span><span class="n">cropped</span><span class="p">)</span>
        <span class="c1"># o3d.visualization.draw_geometries_with_editing(</span>
        <span class="c1">#     [clean], window_name=&quot;Denoised cloud&quot;</span>
        <span class="c1"># )</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusterer</span><span class="o">.</span><span class="n">extract_object</span><span class="p">(</span><span class="n">clean</span><span class="p">)</span>
        <span class="c1"># o3d.visualization.draw_geometries([obj], window_name=&quot;Clustered object&quot;)</span>

        <span class="n">aabb</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">get_bounding_box</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">([</span><span class="n">obj</span><span class="p">,</span> <span class="n">aabb</span><span class="p">],</span> <span class="n">window_name</span><span class="o">=</span><span class="s2">&quot;Bounding box&quot;</span><span class="p">)</span>

        <span class="n">top_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topfinder</span><span class="o">.</span><span class="n">find_top_face</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">top_pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
            <span class="n">top_pcd</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">top_points</span><span class="p">)</span>
            <span class="n">top_pcd</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="c1"># o3d.visualization.draw_geometries(</span>
            <span class="c1">#    [obj, top_pcd], window_name=&quot;Top face points&quot;</span>
            <span class="c1"># )</span>
            <span class="n">traj_start</span><span class="p">,</span> <span class="n">traj_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory_planner</span><span class="o">.</span><span class="n">plan_center_trajectory</span><span class="p">(</span>
                <span class="n">top_points</span>
            <span class="p">)</span>
            <span class="n">traj_line</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">LineSet</span><span class="p">()</span>
            <span class="n">traj_line</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">([</span><span class="n">traj_start</span><span class="p">,</span> <span class="n">traj_end</span><span class="p">])</span>
            <span class="n">traj_line</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector2iVector</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
            <span class="n">traj_line</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">(</span>
                <span class="p">[</span><span class="n">obj</span><span class="p">,</span> <span class="n">top_pcd</span><span class="p">,</span> <span class="n">traj_line</span><span class="p">],</span> <span class="n">window_name</span><span class="o">=</span><span class="s2">&quot;Marker Trajectory&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="vision.PointCloudBuilder" class="doc doc-heading">
            <code>PointCloudBuilder</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Capture and process clouds using a calibrated camera.</p>







              <details class="quote">
                <summary>Source code in <code>vision/pointcloud/builder.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PointCloudBuilder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Capture and process clouds using a calibrated camera.&quot;&quot;&quot;</span>

    <span class="n">camera</span><span class="p">:</span> <span class="n">CameraBase</span>
    <span class="n">handeye</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerType</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">Logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;vision.pointcloud.builder&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">transformer</span><span class="p">:</span> <span class="n">TransformUtils</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">TransformUtils</span><span class="p">)</span>
    <span class="n">generator</span><span class="p">:</span> <span class="n">PointCloudGenerator</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">PointCloudGenerator</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot_pose</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">:</span>
        <span class="n">color</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">get_frames</span><span class="p">()</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get_stream</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
        <span class="n">intr</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">as_video_stream_profile</span><span class="p">()</span><span class="o">.</span><span class="n">get_intrinsics</span><span class="p">()</span>
        <span class="n">K</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fx&quot;</span><span class="p">:</span> <span class="n">intr</span><span class="o">.</span><span class="n">fx</span><span class="p">,</span> <span class="s2">&quot;fy&quot;</span><span class="p">:</span> <span class="n">intr</span><span class="o">.</span><span class="n">fy</span><span class="p">,</span> <span class="s2">&quot;ppx&quot;</span><span class="p">:</span> <span class="n">intr</span><span class="o">.</span><span class="n">ppx</span><span class="p">,</span> <span class="s2">&quot;ppy&quot;</span><span class="p">:</span> <span class="n">intr</span><span class="o">.</span><span class="n">ppy</span><span class="p">}</span>
        <span class="n">depth_m</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">depth_scale</span>
        <span class="n">points</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">depth_to_cloud</span><span class="p">(</span><span class="n">depth_m</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">Rb</span><span class="p">,</span> <span class="n">tb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_robot_pose_to_rt</span><span class="p">(</span><span class="n">robot_pose</span><span class="p">)</span>
        <span class="n">Rc</span><span class="p">,</span> <span class="n">tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handeye</span>
        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">get_base_to_camera</span><span class="p">((</span><span class="n">Rb</span><span class="p">,</span> <span class="n">tb</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Rc</span><span class="p">,</span> <span class="n">tc</span><span class="p">)</span>
        <span class="n">pts_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
        <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
        <span class="n">pcd</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">pts_base</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pcd</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">pcd</span> <span class="o">=</span> <span class="n">pcd</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="n">voxel_size</span><span class="o">=</span><span class="mf">0.002</span><span class="p">)</span>
        <span class="n">pcd</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pcd</span><span class="o">.</span><span class="n">remove_statistical_outlier</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Cloud: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pcd</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2"> points, mean Z </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">points</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> m&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">pcd</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_robot_pose_to_rt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pose</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">euler_to_matrix</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="k">return</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pcd</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_point_cloud</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pcd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved cloud to </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">:</span>
        <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded cloud from </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pcd</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_plane</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">pcd</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">,</span> <span class="n">dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.003</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">:</span>
        <span class="n">plane_model</span><span class="p">,</span> <span class="n">inliers</span> <span class="o">=</span> <span class="n">pcd</span><span class="o">.</span><span class="n">segment_plane</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Plane: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">plane_model</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">inliers</span><span class="p">)</span><span class="si">}</span><span class="s2"> inliers&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">pcd</span><span class="o">.</span><span class="n">select_by_index</span><span class="p">(</span><span class="n">inliers</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="vision.PointCloudGenerator" class="doc doc-heading">
            <code>PointCloudGenerator</code>


</h2>


    <div class="doc doc-contents ">


        <p>Utility class for creating and handling point clouds.</p>







              <details class="quote">
                <summary>Source code in <code>vision/pointcloud/generator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PointCloudGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Utility class for creating and handling point clouds.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pose_to_transform</span><span class="p">(</span>
        <span class="n">pose</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">angles_in_deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert [x, y, z, rx, ry, rz] pose to a 4x4 homogeneous transformation matrix.</span>

<span class="sd">        Args:</span>
<span class="sd">            pose: 6-DOF pose as [x, y, z, rx, ry, rz].</span>
<span class="sd">                x, y, z in millimeters.</span>
<span class="sd">                rx, ry, rz are Euler angles (degrees or radians).</span>
<span class="sd">            angles_in_deg: Whether the input angles are in degrees (default: True).</span>

<span class="sd">        Returns:</span>
<span class="sd">            4x4 SE(3) transformation matrix (numpy.ndarray)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pose</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pose</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Pose must be a sequence of 6 floats: [x, y, z, rx, ry, rz]&quot;</span>
            <span class="p">)</span>

        <span class="n">position</span> <span class="o">=</span> <span class="n">pose</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.0</span>  <span class="c1"># mm â†’ m</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="n">euler_to_matrix</span><span class="p">(</span><span class="o">*</span><span class="n">pose</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span> <span class="n">degrees</span><span class="o">=</span><span class="n">angles_in_deg</span><span class="p">)</span>  <span class="c1"># 3x3</span>

        <span class="k">return</span> <span class="n">make_transform</span><span class="p">(</span><span class="n">rotation</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">depth_to_cloud</span><span class="p">(</span>
        <span class="n">depth</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">intr</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">rgb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">depth_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a depth map (and optionally an RGB image) to a 3D point cloud.</span>

<span class="sd">        Args:</span>
<span class="sd">            depth: HxW float array of depth (meters).</span>
<span class="sd">            intr: Dict with camera intrinsics: fx, fy, ppx (cx), ppy (cy).</span>
<span class="sd">            rgb: Optional HxWx3 or HxWx4 uint8 image for colors.</span>
<span class="sd">            depth_range: Valid depth range (min, max), in meters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            points: (N, 3) float32 array of 3D points.</span>
<span class="sd">            colors: (N, 3) float32 array of RGB colors in [0, 1], or None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">fx</span><span class="p">,</span> <span class="n">fy</span> <span class="o">=</span> <span class="n">intr</span><span class="p">[</span><span class="s2">&quot;fx&quot;</span><span class="p">],</span> <span class="n">intr</span><span class="p">[</span><span class="s2">&quot;fy&quot;</span><span class="p">]</span>
        <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">intr</span><span class="p">[</span><span class="s2">&quot;ppx&quot;</span><span class="p">],</span> <span class="n">intr</span><span class="p">[</span><span class="s2">&quot;ppy&quot;</span><span class="p">]</span>
        <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">depth_range</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">depth</span> <span class="o">&gt;</span> <span class="n">z_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth</span> <span class="o">&lt;</span> <span class="n">z_max</span><span class="p">)</span>
        <span class="c1"># np.where return y, x</span>
        <span class="n">ys</span><span class="p">,</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">ys</span><span class="p">,</span> <span class="n">xs</span><span class="p">]</span>
        <span class="c1"># pinhole formula</span>
        <span class="n">xs_</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span> <span class="o">*</span> <span class="n">zs</span> <span class="o">/</span> <span class="n">fx</span>
        <span class="n">ys_</span> <span class="o">=</span> <span class="p">(</span><span class="n">ys</span> <span class="o">-</span> <span class="n">cy</span><span class="p">)</span> <span class="o">*</span> <span class="n">zs</span> <span class="o">/</span> <span class="n">fy</span>
        <span class="c1"># stack in cloud Nx3</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">xs_</span><span class="p">,</span> <span class="n">ys_</span><span class="p">,</span> <span class="n">zs</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">rgb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># Discard alpha if present</span>
            <span class="c1"># rgb[ys, xs] â€” colors for valid points</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">[</span><span class="n">ys</span><span class="p">,</span> <span class="n">xs</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">colors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>  <span class="c1"># [:, ::-1] RGB â†’ BGR for opencv</span>
            <span class="k">return</span> <span class="n">points</span><span class="p">,</span> <span class="n">colors</span>
        <span class="k">return</span> <span class="n">points</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_ply</span><span class="p">(</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">colors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save a point cloud to a PLY file using Open3D.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: Output path.</span>
<span class="sd">            points: (N, 3) array.</span>
<span class="sd">            colors: (N, 3) array in [0, 1] or None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
        <span class="n">pcd</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pcd</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_point_cloud</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pcd</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_ply</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a point cloud from a PLY file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            points: (N, 3) array.</span>
<span class="sd">            colors: (N, 3) array or None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pcd</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pcd</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span> <span class="k">if</span> <span class="n">pcd</span><span class="o">.</span><span class="n">has_colors</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">points</span><span class="p">,</span> <span class="n">colors</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">downsample_cloud</span><span class="p">(</span>
        <span class="n">pcd</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">,</span> <span class="n">voxel_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downsample a point cloud using voxel grid filtering.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pcd</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="n">voxel_size</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">icp_pairwise_align</span><span class="p">(</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform pairwise ICP registration (point-to-point).</span>

<span class="sd">        Returns:</span>
<span class="sd">            4x4 transformation matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">registration_icp</span><span class="p">(</span>
            <span class="n">source</span><span class="p">,</span>
            <span class="n">target</span><span class="p">,</span>
            <span class="n">threshold</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
            <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">TransformationEstimationPointToPoint</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">reg</span><span class="o">.</span><span class="n">transformation</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">merge_clouds</span><span class="p">(</span>
        <span class="n">clouds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">],</span>
        <span class="n">voxel_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.003</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge a list of point clouds, with optional voxel downsampling.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">merged</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pcd</span> <span class="ow">in</span> <span class="n">clouds</span><span class="p">:</span>
            <span class="n">merged</span> <span class="o">+=</span> <span class="n">pcd</span>
        <span class="k">if</span> <span class="n">voxel_size</span><span class="p">:</span>
            <span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="n">voxel_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">merged</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">filter_cloud</span><span class="p">(</span>
        <span class="n">pcd</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">,</span>
        <span class="n">nb_neighbors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">std_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove outliers from a point cloud using statistical filtering.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cl</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pcd</span><span class="o">.</span><span class="n">remove_statistical_outlier</span><span class="p">(</span>
            <span class="n">nb_neighbors</span><span class="o">=</span><span class="n">nb_neighbors</span><span class="p">,</span> <span class="n">std_ratio</span><span class="o">=</span><span class="n">std_ratio</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cl</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">visualize</span><span class="p">(</span><span class="n">pcd</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualize a point cloud using Open3D&#39;s viewer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">([</span><span class="n">pcd</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="vision.PointCloudGenerator.depth_to_cloud" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">depth_to_cloud</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">intr</span><span class="p">,</span> <span class="n">rgb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">depth_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Convert a depth map (and optionally an RGB image) to a 3D point cloud.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>depth</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HxW float array of depth (meters).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>intr</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with camera intrinsics: fx, fy, ppx (cx), ppy (cy).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rgb</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional HxWx3 or HxWx4 uint8 image for colors.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>depth_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Valid depth range (min, max), in meters.</p>
              </div>
            </td>
            <td>
                  <code>(0.1, 1.0)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>points</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 3) float32 array of 3D points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>colors</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 3) float32 array of RGB colors in [0, 1], or None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vision/pointcloud/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">depth_to_cloud</span><span class="p">(</span>
    <span class="n">depth</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">intr</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">rgb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">depth_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a depth map (and optionally an RGB image) to a 3D point cloud.</span>

<span class="sd">    Args:</span>
<span class="sd">        depth: HxW float array of depth (meters).</span>
<span class="sd">        intr: Dict with camera intrinsics: fx, fy, ppx (cx), ppy (cy).</span>
<span class="sd">        rgb: Optional HxWx3 or HxWx4 uint8 image for colors.</span>
<span class="sd">        depth_range: Valid depth range (min, max), in meters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        points: (N, 3) float32 array of 3D points.</span>
<span class="sd">        colors: (N, 3) float32 array of RGB colors in [0, 1], or None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">fx</span><span class="p">,</span> <span class="n">fy</span> <span class="o">=</span> <span class="n">intr</span><span class="p">[</span><span class="s2">&quot;fx&quot;</span><span class="p">],</span> <span class="n">intr</span><span class="p">[</span><span class="s2">&quot;fy&quot;</span><span class="p">]</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">intr</span><span class="p">[</span><span class="s2">&quot;ppx&quot;</span><span class="p">],</span> <span class="n">intr</span><span class="p">[</span><span class="s2">&quot;ppy&quot;</span><span class="p">]</span>
    <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">depth_range</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">depth</span> <span class="o">&gt;</span> <span class="n">z_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth</span> <span class="o">&lt;</span> <span class="n">z_max</span><span class="p">)</span>
    <span class="c1"># np.where return y, x</span>
    <span class="n">ys</span><span class="p">,</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="n">zs</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">ys</span><span class="p">,</span> <span class="n">xs</span><span class="p">]</span>
    <span class="c1"># pinhole formula</span>
    <span class="n">xs_</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span> <span class="o">*</span> <span class="n">zs</span> <span class="o">/</span> <span class="n">fx</span>
    <span class="n">ys_</span> <span class="o">=</span> <span class="p">(</span><span class="n">ys</span> <span class="o">-</span> <span class="n">cy</span><span class="p">)</span> <span class="o">*</span> <span class="n">zs</span> <span class="o">/</span> <span class="n">fy</span>
    <span class="c1"># stack in cloud Nx3</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">xs_</span><span class="p">,</span> <span class="n">ys_</span><span class="p">,</span> <span class="n">zs</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">rgb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># Discard alpha if present</span>
        <span class="c1"># rgb[ys, xs] â€” colors for valid points</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">[</span><span class="n">ys</span><span class="p">,</span> <span class="n">xs</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">colors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>  <span class="c1"># [:, ::-1] RGB â†’ BGR for opencv</span>
        <span class="k">return</span> <span class="n">points</span><span class="p">,</span> <span class="n">colors</span>
    <span class="k">return</span> <span class="n">points</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.PointCloudGenerator.downsample_cloud" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">downsample_cloud</span><span class="p">(</span><span class="n">pcd</span><span class="p">,</span> <span class="n">voxel_size</span><span class="o">=</span><span class="mf">0.005</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Downsample a point cloud using voxel grid filtering.</p>


            <details class="quote">
              <summary>Source code in <code>vision/pointcloud/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">downsample_cloud</span><span class="p">(</span>
    <span class="n">pcd</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">,</span> <span class="n">voxel_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Downsample a point cloud using voxel grid filtering.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pcd</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="n">voxel_size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.PointCloudGenerator.filter_cloud" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_cloud</span><span class="p">(</span><span class="n">pcd</span><span class="p">,</span> <span class="n">nb_neighbors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">std_ratio</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Remove outliers from a point cloud using statistical filtering.</p>


            <details class="quote">
              <summary>Source code in <code>vision/pointcloud/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">filter_cloud</span><span class="p">(</span>
    <span class="n">pcd</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">,</span>
    <span class="n">nb_neighbors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">std_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove outliers from a point cloud using statistical filtering.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cl</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pcd</span><span class="o">.</span><span class="n">remove_statistical_outlier</span><span class="p">(</span>
        <span class="n">nb_neighbors</span><span class="o">=</span><span class="n">nb_neighbors</span><span class="p">,</span> <span class="n">std_ratio</span><span class="o">=</span><span class="n">std_ratio</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">cl</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.PointCloudGenerator.icp_pairwise_align" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">icp_pairwise_align</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Perform pairwise ICP registration (point-to-point).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>4x4 transformation matrix.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vision/pointcloud/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">icp_pairwise_align</span><span class="p">(</span>
    <span class="n">source</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform pairwise ICP registration (point-to-point).</span>

<span class="sd">    Returns:</span>
<span class="sd">        4x4 transformation matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reg</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">registration_icp</span><span class="p">(</span>
        <span class="n">source</span><span class="p">,</span>
        <span class="n">target</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
        <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">TransformationEstimationPointToPoint</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">reg</span><span class="o">.</span><span class="n">transformation</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.PointCloudGenerator.load_ply" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_ply</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Load a point cloud from a PLY file.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>points</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 3) array.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>colors</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 3) array or None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vision/pointcloud/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_ply</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a point cloud from a PLY file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        points: (N, 3) array.</span>
<span class="sd">        colors: (N, 3) array or None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pcd</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pcd</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span> <span class="k">if</span> <span class="n">pcd</span><span class="o">.</span><span class="n">has_colors</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">points</span><span class="p">,</span> <span class="n">colors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.PointCloudGenerator.merge_clouds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_clouds</span><span class="p">(</span><span class="n">clouds</span><span class="p">,</span> <span class="n">voxel_size</span><span class="o">=</span><span class="mf">0.003</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Merge a list of point clouds, with optional voxel downsampling.</p>


            <details class="quote">
              <summary>Source code in <code>vision/pointcloud/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">merge_clouds</span><span class="p">(</span>
    <span class="n">clouds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">],</span>
    <span class="n">voxel_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.003</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge a list of point clouds, with optional voxel downsampling.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">pcd</span> <span class="ow">in</span> <span class="n">clouds</span><span class="p">:</span>
        <span class="n">merged</span> <span class="o">+=</span> <span class="n">pcd</span>
    <span class="k">if</span> <span class="n">voxel_size</span><span class="p">:</span>
        <span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="n">voxel_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merged</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.PointCloudGenerator.pose_to_transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pose_to_transform</span><span class="p">(</span><span class="n">pose</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">angles_in_deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Convert [x, y, z, rx, ry, rz] pose to a 4x4 homogeneous transformation matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pose</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>] | <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>6-DOF pose as [x, y, z, rx, ry, rz].
x, y, z in millimeters.
rx, ry, rz are Euler angles (degrees or radians).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>angles_in_deg</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the input angles are in degrees (default: True).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>4x4 SE(3) transformation matrix (numpy.ndarray)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vision/pointcloud/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">pose_to_transform</span><span class="p">(</span>
    <span class="n">pose</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">angles_in_deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert [x, y, z, rx, ry, rz] pose to a 4x4 homogeneous transformation matrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        pose: 6-DOF pose as [x, y, z, rx, ry, rz].</span>
<span class="sd">            x, y, z in millimeters.</span>
<span class="sd">            rx, ry, rz are Euler angles (degrees or radians).</span>
<span class="sd">        angles_in_deg: Whether the input angles are in degrees (default: True).</span>

<span class="sd">    Returns:</span>
<span class="sd">        4x4 SE(3) transformation matrix (numpy.ndarray)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pose</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pose</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Pose must be a sequence of 6 floats: [x, y, z, rx, ry, rz]&quot;</span>
        <span class="p">)</span>

    <span class="n">position</span> <span class="o">=</span> <span class="n">pose</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.0</span>  <span class="c1"># mm â†’ m</span>
    <span class="n">rotation</span> <span class="o">=</span> <span class="n">euler_to_matrix</span><span class="p">(</span><span class="o">*</span><span class="n">pose</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span> <span class="n">degrees</span><span class="o">=</span><span class="n">angles_in_deg</span><span class="p">)</span>  <span class="c1"># 3x3</span>

    <span class="k">return</span> <span class="n">make_transform</span><span class="p">(</span><span class="n">rotation</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.PointCloudGenerator.save_ply" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_ply</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Save a point cloud to a PLY file using Open3D.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>points</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 3) array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colors</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 3) array in [0, 1] or None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vision/pointcloud/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_ply</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a point cloud to a PLY file using Open3D.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: Output path.</span>
<span class="sd">        points: (N, 3) array.</span>
<span class="sd">        colors: (N, 3) array in [0, 1] or None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
    <span class="n">pcd</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pcd</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_point_cloud</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pcd</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.PointCloudGenerator.visualize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">visualize</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Visualize a point cloud using Open3D's viewer.</p>


            <details class="quote">
              <summary>Source code in <code>vision/pointcloud/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">visualize</span><span class="p">(</span><span class="n">pcd</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize a point cloud using Open3D&#39;s viewer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">([</span><span class="n">pcd</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="vision.RGBDAggregator" class="doc doc-heading">
            <code>RGBDAggregator</code>


</h2>


    <div class="doc doc-contents ">








              <details class="quote">
                <summary>Source code in <code>vision/pointcloud/aggregator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RGBDAggregator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="n">Logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;cloud.aggregator&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cloud_gen</span> <span class="o">=</span> <span class="n">PointCloudGenerator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span> <span class="o">=</span> <span class="n">TransformUtils</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img_pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
        <span class="n">rotations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">translations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">intrinsics</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">R_handeye</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">t_handeye</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">R_depth2rgb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">t_depth2rgb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">align</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge frames into a single cloud with optional alignment.&quot;&quot;&quot;</span>
        <span class="n">base_pcd</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">((</span><span class="n">rgb_path</span><span class="p">,</span> <span class="n">depth_path</span><span class="p">),</span> <span class="p">(</span><span class="n">R_tcp</span><span class="p">,</span> <span class="n">t_tcp</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">img_pairs</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rotations</span><span class="p">,</span> <span class="n">translations</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing frame </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">rgb_path</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">depth_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">rgb_path</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">load_depth</span><span class="p">(</span><span class="n">depth_path</span><span class="p">)</span>
            <span class="n">cam_intr</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;fx&quot;</span><span class="p">:</span> <span class="n">intrinsics</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;fy&quot;</span><span class="p">:</span> <span class="n">intrinsics</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;ppx&quot;</span><span class="p">:</span> <span class="n">intrinsics</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="s2">&quot;ppy&quot;</span><span class="p">:</span> <span class="n">intrinsics</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="n">points</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloud_gen</span><span class="o">.</span><span class="n">depth_to_cloud</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">cam_intr</span><span class="p">,</span> <span class="n">rgb</span><span class="p">)</span>
            <span class="n">T_rgb_ir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">build_transform</span><span class="p">(</span><span class="n">R_depth2rgb</span><span class="p">,</span> <span class="n">t_depth2rgb</span><span class="p">)</span>
            <span class="n">T_tcp_cam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">build_transform</span><span class="p">(</span><span class="n">R_handeye</span><span class="p">,</span> <span class="n">t_handeye</span><span class="p">)</span>
            <span class="n">T_tcp_rgb</span> <span class="o">=</span> <span class="n">T_tcp_cam</span> <span class="o">@</span> <span class="n">T_rgb_ir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frame </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> points (in RGB frame).&quot;</span><span class="p">)</span>
            <span class="n">T_base_tcp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">build_transform</span><span class="p">(</span><span class="n">R_tcp</span><span class="p">,</span> <span class="n">t_tcp</span><span class="p">)</span>
            <span class="n">T_base_cam</span> <span class="o">=</span> <span class="n">T_base_tcp</span> <span class="o">@</span> <span class="n">T_tcp_rgb</span>
            <span class="n">points_world</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">T_base_cam</span><span class="p">)</span>
            <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
            <span class="n">pcd</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">points_world</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pcd</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">base_pcd</span> <span class="o">=</span> <span class="n">pcd</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;First cloud set as base.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="s2">&quot;open3d&quot;</span><span class="p">:</span>
                    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.003</span>
                    <span class="n">reg</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">registration_icp</span><span class="p">(</span>
                        <span class="n">pcd</span><span class="p">,</span>
                        <span class="n">base_pcd</span><span class="p">,</span>
                        <span class="n">threshold</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
                        <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">TransformationEstimationPointToPoint</span><span class="p">(),</span>
                    <span class="p">)</span>
                    <span class="n">rmse</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">inlier_rmse</span>
                    <span class="n">cnt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="o">.</span><span class="n">correspondence_set</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ICP frame </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">: RMSE=</span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, pairs=</span><span class="si">{</span><span class="n">cnt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">pcd</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">reg</span><span class="o">.</span><span class="n">transformation</span><span class="p">)</span>
                <span class="n">base_pcd</span> <span class="o">+=</span> <span class="n">pcd</span>
                <span class="n">base_pcd</span> <span class="o">=</span> <span class="n">base_pcd</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="n">voxel_size</span><span class="o">=</span><span class="mf">0.003</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">base_pcd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">all_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">base_pcd</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="n">all_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">base_pcd</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span> <span class="k">if</span> <span class="n">base_pcd</span><span class="o">.</span><span class="n">has_colors</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">all_points</span><span class="p">,</span> <span class="n">all_colors</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_cloud</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">colors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cloud_gen</span><span class="o">.</span><span class="n">save_ply</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Aggregated cloud saved: </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="vision.RGBDAggregator.aggregate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggregate</span><span class="p">(</span><span class="n">img_pairs</span><span class="p">,</span> <span class="n">rotations</span><span class="p">,</span> <span class="n">translations</span><span class="p">,</span> <span class="n">intrinsics</span><span class="p">,</span> <span class="n">R_handeye</span><span class="p">,</span> <span class="n">t_handeye</span><span class="p">,</span> <span class="n">R_depth2rgb</span><span class="p">,</span> <span class="n">t_depth2rgb</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Merge frames into a single cloud with optional alignment.</p>


            <details class="quote">
              <summary>Source code in <code>vision/pointcloud/aggregator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">img_pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
    <span class="n">rotations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">translations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">intrinsics</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">R_handeye</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">t_handeye</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">R_depth2rgb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">t_depth2rgb</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">align</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge frames into a single cloud with optional alignment.&quot;&quot;&quot;</span>
    <span class="n">base_pcd</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">((</span><span class="n">rgb_path</span><span class="p">,</span> <span class="n">depth_path</span><span class="p">),</span> <span class="p">(</span><span class="n">R_tcp</span><span class="p">,</span> <span class="n">t_tcp</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span><span class="n">img_pairs</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rotations</span><span class="p">,</span> <span class="n">translations</span><span class="p">))</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing frame </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">rgb_path</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">depth_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">rgb_path</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">load_depth</span><span class="p">(</span><span class="n">depth_path</span><span class="p">)</span>
        <span class="n">cam_intr</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;fx&quot;</span><span class="p">:</span> <span class="n">intrinsics</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;fy&quot;</span><span class="p">:</span> <span class="n">intrinsics</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;ppx&quot;</span><span class="p">:</span> <span class="n">intrinsics</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="s2">&quot;ppy&quot;</span><span class="p">:</span> <span class="n">intrinsics</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">points</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloud_gen</span><span class="o">.</span><span class="n">depth_to_cloud</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">cam_intr</span><span class="p">,</span> <span class="n">rgb</span><span class="p">)</span>
        <span class="n">T_rgb_ir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">build_transform</span><span class="p">(</span><span class="n">R_depth2rgb</span><span class="p">,</span> <span class="n">t_depth2rgb</span><span class="p">)</span>
        <span class="n">T_tcp_cam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">build_transform</span><span class="p">(</span><span class="n">R_handeye</span><span class="p">,</span> <span class="n">t_handeye</span><span class="p">)</span>
        <span class="n">T_tcp_rgb</span> <span class="o">=</span> <span class="n">T_tcp_cam</span> <span class="o">@</span> <span class="n">T_rgb_ir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frame </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> points (in RGB frame).&quot;</span><span class="p">)</span>
        <span class="n">T_base_tcp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">build_transform</span><span class="p">(</span><span class="n">R_tcp</span><span class="p">,</span> <span class="n">t_tcp</span><span class="p">)</span>
        <span class="n">T_base_cam</span> <span class="o">=</span> <span class="n">T_base_tcp</span> <span class="o">@</span> <span class="n">T_tcp_rgb</span>
        <span class="n">points_world</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">T_base_cam</span><span class="p">)</span>
        <span class="n">pcd</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">()</span>
        <span class="n">pcd</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">points_world</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pcd</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">Vector3dVector</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">base_pcd</span> <span class="o">=</span> <span class="n">pcd</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;First cloud set as base.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="s2">&quot;open3d&quot;</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.003</span>
                <span class="n">reg</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">registration_icp</span><span class="p">(</span>
                    <span class="n">pcd</span><span class="p">,</span>
                    <span class="n">base_pcd</span><span class="p">,</span>
                    <span class="n">threshold</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
                    <span class="n">o3d</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">TransformationEstimationPointToPoint</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="n">rmse</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">inlier_rmse</span>
                <span class="n">cnt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="o">.</span><span class="n">correspondence_set</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ICP frame </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">: RMSE=</span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">, pairs=</span><span class="si">{</span><span class="n">cnt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">pcd</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">reg</span><span class="o">.</span><span class="n">transformation</span><span class="p">)</span>
            <span class="n">base_pcd</span> <span class="o">+=</span> <span class="n">pcd</span>
            <span class="n">base_pcd</span> <span class="o">=</span> <span class="n">base_pcd</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="n">voxel_size</span><span class="o">=</span><span class="mf">0.003</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">base_pcd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">all_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">base_pcd</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
    <span class="n">all_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">base_pcd</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span> <span class="k">if</span> <span class="n">base_pcd</span><span class="o">.</span><span class="n">has_colors</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">all_points</span><span class="p">,</span> <span class="n">all_colors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="vision.RealSenseD415" class="doc doc-heading">
            <code>RealSenseD415</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CameraBase (vision.camera.camera_base.CameraBase)" href="#vision.CameraBase">CameraBase</a></code></p>


        <p>RealSense D415 RGB-D camera driver.</p>







              <details class="quote">
                <summary>Source code in <code>vision/camera/realsense_d415.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RealSenseD415</span><span class="p">(</span><span class="n">CameraBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;RealSense D415 RGB-D camera driver.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">stream_cfg</span><span class="p">:</span> <span class="n">D415_Cfg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">settings</span><span class="p">:</span> <span class="n">D415CameraSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filters</span><span class="p">:</span> <span class="n">D415FilterConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new camera instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stream_cfg:</span>
<span class="sd">            Optional streaming configuration.  If ``None`` the global</span>
<span class="sd">            :data:`utils.settings.camera` is used.</span>
<span class="sd">        settings:</span>
<span class="sd">            Manual exposure and laser options.</span>
<span class="sd">        filters:</span>
<span class="sd">            Post-processing filter configuration.</span>
<span class="sd">        logger:</span>
<span class="sd">            Logger to use for all messages.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span> <span class="o">=</span> <span class="n">stream_cfg</span> <span class="ow">or</span> <span class="n">camera</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span> <span class="ow">or</span> <span class="n">D415CameraSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="ow">or</span> <span class="n">D415FilterConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="n">Logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;vision.d415&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">:</span> <span class="n">rs</span><span class="o">.</span><span class="n">pipeline_profile</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">:</span> <span class="n">rs</span><span class="o">.</span><span class="n">align</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_config</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pre-configure the pipeline with the desired streams.&quot;&quot;&quot;</span>

        <span class="n">cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_stream</span><span class="p">(</span>
            <span class="n">rs</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">depth_width</span><span class="p">,</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">depth_height</span><span class="p">,</span>
            <span class="n">rs</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">z16</span><span class="p">,</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_stream</span><span class="p">(</span>
            <span class="n">rs</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">rgb_width</span><span class="p">,</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">rgb_height</span><span class="p">,</span>
            <span class="n">rs</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">bgr8</span><span class="p">,</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start streaming from the camera.&quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">config</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">enable_stream</span><span class="p">(</span>
            <span class="n">rs</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">depth_width</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">depth_height</span><span class="p">,</span>
            <span class="n">rs</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">z16</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">enable_stream</span><span class="p">(</span>
            <span class="n">rs</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">rgb_width</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">rgb_height</span><span class="p">,</span>
            <span class="n">rs</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">bgr8</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
        <span class="n">sensors</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">camera_info</span><span class="o">.</span><span class="n">name</span><span class="p">):</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">device</span><span class="o">.</span><span class="n">sensors</span><span class="p">}</span>
        <span class="n">sensor</span> <span class="o">=</span> <span class="n">sensors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Stereo Module&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sensor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Stereo Module (depth sensor) not found&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sensor</span><span class="o">.</span><span class="n">supports</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">depth_units</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Sensor does not support depth_units (not a depth sensor?)&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">depth_sensor</span> <span class="o">=</span> <span class="n">sensor</span><span class="o">.</span><span class="n">as_depth_sensor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgb_sensor</span> <span class="o">=</span> <span class="n">sensors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;RGB Camera&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_sensor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb_sensor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Required sensors not found&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_sensor</span><span class="o">.</span><span class="n">get_depth_scale</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Depth scale: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_scale</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> m/unit&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">align_to_color</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">align</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Depth frames will be aligned to color&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">align</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No alignment between depth and color&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log_device_info</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_filters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_sensor</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">enable_auto_exposure</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">power</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">projector_power</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_sensor</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">laser_power</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgb_sensor</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">enable_auto_exposure</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgb_sensor</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">exposure</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rgb_exposure</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgb_sensor</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">gain</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rgb_gain</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize depth post-processing filters.&quot;&quot;&quot;</span>

        <span class="n">cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decimation</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">decimation_filter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decimation</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">filter_magnitude</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">decimation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spatial</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">spatial_filter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">filter_smooth_alpha</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">spatial_alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">filter_smooth_delta</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">spatial_delta</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">temporal</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">temporal_filter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">filter_smooth_alpha</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">temporal_alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">filter_smooth_delta</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">temporal_delta</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hole_filling</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">hole_filling_filter</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">hole_filling</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_log_device_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">rs</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">camera_info</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">serial</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">camera_info</span><span class="o">.</span><span class="n">serial_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Device: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> SN:</span><span class="si">{</span><span class="n">serial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">depth_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get_stream</span><span class="p">(</span>
            <span class="n">rs</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">depth</span>
        <span class="p">)</span><span class="o">.</span><span class="n">as_video_stream_profile</span><span class="p">()</span>
        <span class="n">color_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get_stream</span><span class="p">(</span>
            <span class="n">rs</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">color</span>
        <span class="p">)</span><span class="o">.</span><span class="n">as_video_stream_profile</span><span class="p">()</span>
        <span class="n">extr</span> <span class="o">=</span> <span class="n">depth_stream</span><span class="o">.</span><span class="n">get_extrinsics_to</span><span class="p">(</span><span class="n">color_stream</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">extr</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">extr</span><span class="o">.</span><span class="n">translation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extrinsics depthâ†’color R=</span><span class="si">{</span><span class="n">R</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2"> t=</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop camera streaming.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_projector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable or disable the infrared projector.&quot;&quot;&quot;</span>

        <span class="n">power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">max_projector_power</span> <span class="k">if</span> <span class="n">enable</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_sensor</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">laser_power</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">power</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">rs</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">rs</span><span class="o">.</span><span class="n">frame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply post-processing filters to a depth frame.&quot;&quot;&quot;</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimation</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hole_filling</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">frame</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_frames</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">aligned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the next color and depth frame pair.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        aligned : bool</span>
<span class="sd">            If True, depth will be aligned to color.</span>
<span class="sd">        as_float : bool</span>
<span class="sd">            If True, depth will be returned in meters using depth_scale.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        color_img : np.ndarray or None</span>
<span class="sd">            The RGB image (BGR format).</span>
<span class="sd">        depth_img : np.ndarray or None</span>
<span class="sd">            The depth map (aligned if specified). In meters if as_float=True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="p">,</span> <span class="s2">&quot;Camera not started&quot;</span>
        <span class="k">if</span> <span class="n">aligned</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">align_to_color</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;get_frames(aligned=True) is invalid because align_to_color=False&quot;</span>
            <span class="p">)</span>

        <span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">wait_for_frames</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">aligned</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">:</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>

        <span class="n">depth_frame</span> <span class="o">=</span> <span class="n">frames</span><span class="o">.</span><span class="n">get_depth_frame</span><span class="p">()</span>
        <span class="n">color_frame</span> <span class="o">=</span> <span class="n">frames</span><span class="o">.</span><span class="n">get_color_frame</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">depth_frame</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">color_frame</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">depth_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_depth</span><span class="p">(</span><span class="n">depth_frame</span><span class="p">)</span>
        <span class="n">color_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">color_frame</span><span class="o">.</span><span class="n">get_data</span><span class="p">())</span>
        <span class="n">depth_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">depth_frame</span><span class="o">.</span><span class="n">get_data</span><span class="p">())</span>

        <span class="c1"># Convert depth to float (meters)</span>
        <span class="k">if</span> <span class="n">as_float</span><span class="p">:</span>
            <span class="n">depth_img</span> <span class="o">=</span> <span class="n">depth_img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_scale</span>

        <span class="k">if</span> <span class="n">aligned</span> <span class="ow">and</span> <span class="n">color_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">depth_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Aligned depth and color resolution mismatch&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">color_img</span><span class="p">,</span> <span class="n">depth_img</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="vision.RealSenseD415.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">stream_cfg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new camera instance.</p>
<h5 id="vision.RealSenseD415.__init__--parameters">Parameters</h5>
<p>stream_cfg:
    Optional streaming configuration.  If <code>None</code> the global
    :data:<code>utils.settings.camera</code> is used.
settings:
    Manual exposure and laser options.
filters:
    Post-processing filter configuration.
logger:
    Logger to use for all messages.</p>


            <details class="quote">
              <summary>Source code in <code>vision/camera/realsense_d415.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">stream_cfg</span><span class="p">:</span> <span class="n">D415_Cfg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">D415CameraSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filters</span><span class="p">:</span> <span class="n">D415FilterConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new camera instance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    stream_cfg:</span>
<span class="sd">        Optional streaming configuration.  If ``None`` the global</span>
<span class="sd">        :data:`utils.settings.camera` is used.</span>
<span class="sd">    settings:</span>
<span class="sd">        Manual exposure and laser options.</span>
<span class="sd">    filters:</span>
<span class="sd">        Post-processing filter configuration.</span>
<span class="sd">    logger:</span>
<span class="sd">        Logger to use for all messages.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span> <span class="o">=</span> <span class="n">stream_cfg</span> <span class="ow">or</span> <span class="n">camera</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span> <span class="ow">or</span> <span class="n">D415CameraSettings</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="ow">or</span> <span class="n">D415FilterConfig</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="n">Logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;vision.d415&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">config</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">:</span> <span class="n">rs</span><span class="o">.</span><span class="n">pipeline_profile</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">:</span> <span class="n">rs</span><span class="o">.</span><span class="n">align</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depth_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_init_config</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.RealSenseD415.get_frames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_frames</span><span class="p">(</span><span class="n">aligned</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_float</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the next color and depth frame pair.</p>
<h5 id="vision.RealSenseD415.get_frames--parameters">Parameters</h5>
<p>aligned : bool
    If True, depth will be aligned to color.
as_float : bool
    If True, depth will be returned in meters using depth_scale.</p>
<h5 id="vision.RealSenseD415.get_frames--returns">Returns</h5>
<p>color_img : np.ndarray or None
    The RGB image (BGR format).
depth_img : np.ndarray or None
    The depth map (aligned if specified). In meters if as_float=True.</p>


            <details class="quote">
              <summary>Source code in <code>vision/camera/realsense_d415.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_frames</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">aligned</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_float</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the next color and depth frame pair.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    aligned : bool</span>
<span class="sd">        If True, depth will be aligned to color.</span>
<span class="sd">    as_float : bool</span>
<span class="sd">        If True, depth will be returned in meters using depth_scale.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    color_img : np.ndarray or None</span>
<span class="sd">        The RGB image (BGR format).</span>
<span class="sd">    depth_img : np.ndarray or None</span>
<span class="sd">        The depth map (aligned if specified). In meters if as_float=True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="p">,</span> <span class="s2">&quot;Camera not started&quot;</span>
    <span class="k">if</span> <span class="n">aligned</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">align_to_color</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;get_frames(aligned=True) is invalid because align_to_color=False&quot;</span>
        <span class="p">)</span>

    <span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">wait_for_frames</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">aligned</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">:</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>

    <span class="n">depth_frame</span> <span class="o">=</span> <span class="n">frames</span><span class="o">.</span><span class="n">get_depth_frame</span><span class="p">()</span>
    <span class="n">color_frame</span> <span class="o">=</span> <span class="n">frames</span><span class="o">.</span><span class="n">get_color_frame</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">depth_frame</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">color_frame</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">depth_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_depth</span><span class="p">(</span><span class="n">depth_frame</span><span class="p">)</span>
    <span class="n">color_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">color_frame</span><span class="o">.</span><span class="n">get_data</span><span class="p">())</span>
    <span class="n">depth_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">depth_frame</span><span class="o">.</span><span class="n">get_data</span><span class="p">())</span>

    <span class="c1"># Convert depth to float (meters)</span>
    <span class="k">if</span> <span class="n">as_float</span><span class="p">:</span>
        <span class="n">depth_img</span> <span class="o">=</span> <span class="n">depth_img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_scale</span>

    <span class="k">if</span> <span class="n">aligned</span> <span class="ow">and</span> <span class="n">color_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">depth_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Aligned depth and color resolution mismatch&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">color_img</span><span class="p">,</span> <span class="n">depth_img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.RealSenseD415.set_projector" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_projector</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Enable or disable the infrared projector.</p>


            <details class="quote">
              <summary>Source code in <code>vision/camera/realsense_d415.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_projector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enable or disable the infrared projector.&quot;&quot;&quot;</span>

    <span class="n">power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">max_projector_power</span> <span class="k">if</span> <span class="n">enable</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depth_sensor</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">laser_power</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">power</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.RealSenseD415.start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Start streaming from the camera.</p>


            <details class="quote">
              <summary>Source code in <code>vision/camera/realsense_d415.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Start streaming from the camera.&quot;&quot;&quot;</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">config</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">enable_stream</span><span class="p">(</span>
        <span class="n">rs</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">depth_width</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">depth_height</span><span class="p">,</span>
        <span class="n">rs</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">z16</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">enable_stream</span><span class="p">(</span>
        <span class="n">rs</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">rgb_width</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">rgb_height</span><span class="p">,</span>
        <span class="n">rs</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">bgr8</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">get_device</span><span class="p">()</span>
    <span class="n">sensors</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">camera_info</span><span class="o">.</span><span class="n">name</span><span class="p">):</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">device</span><span class="o">.</span><span class="n">sensors</span><span class="p">}</span>
    <span class="n">sensor</span> <span class="o">=</span> <span class="n">sensors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Stereo Module&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sensor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Stereo Module (depth sensor) not found&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">sensor</span><span class="o">.</span><span class="n">supports</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">depth_units</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Sensor does not support depth_units (not a depth sensor?)&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">depth_sensor</span> <span class="o">=</span> <span class="n">sensor</span><span class="o">.</span><span class="n">as_depth_sensor</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rgb_sensor</span> <span class="o">=</span> <span class="n">sensors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;RGB Camera&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_sensor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb_sensor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Required sensors not found&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depth_scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_sensor</span><span class="o">.</span><span class="n">get_depth_scale</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Depth scale: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_scale</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> m/unit&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_cfg</span><span class="o">.</span><span class="n">align_to_color</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">align</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Depth frames will be aligned to color&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">align</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No alignment between depth and color&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_log_device_info</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_filters</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vision.RealSenseD415.stop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stop</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Stop camera streaming.</p>


            <details class="quote">
              <summary>Source code in <code>vision/camera/realsense_d415.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stop camera streaming.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="utils"></a>
    <div class="doc doc-contents first">

        <p>Shared helper modules used across the project.</p>
<p>The :mod:<code>utils</code> package contains lightweight helpers for logging, CLI
dispatching and simple file I/O. These utilities are used by most other
packages and avoid additional dependencies.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="utils.D415_Cfg" class="doc doc-heading">
            <code>D415_Cfg</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Intel RealSense D415 camera configuration:
- frame size (color/depth)
- frame rate
- depth scale
- alignment mode</p>







              <details class="quote">
                <summary>Source code in <code>utils/settings.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">D415_Cfg</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Intel RealSense D415 camera configuration:</span>
<span class="sd">    - frame size (color/depth)</span>
<span class="sd">    - frame rate</span>
<span class="sd">    - depth scale</span>
<span class="sd">    - alignment mode</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rgb_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1920</span>
    <span class="n">rgb_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1080</span>
    <span class="c1"># rgb_width: int = 1280</span>
    <span class="c1"># rgb_height: int = 720</span>
    <span class="n">depth_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1280</span>
    <span class="n">depth_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">720</span>
    <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="c1"># TODO clarify depth_scale import at all python pakages</span>
    <span class="c1"># and del DEPTH_SCALE anywhere</span>
    <span class="n">depth_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEPTH_SCALE</span>
    <span class="n">align_to_color</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="utils.GridCalibCfg" class="doc doc-heading">
            <code>GridCalibCfg</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Grid-based workspace sampling for hand-eye calibration.
Defines the limits, grid step, orientation, and output.</p>







              <details class="quote">
                <summary>Source code in <code>utils/settings.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GridCalibCfg</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Grid-based workspace sampling for hand-eye calibration.</span>
<span class="sd">    Defines the limits, grid step, orientation, and output.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">calibration_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EYE_IN_HAND&quot;</span>
    <span class="n">workspace_limits</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span>
        <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="o">-</span><span class="mf">70.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">),</span>  <span class="c1"># X, mm</span>
        <span class="p">(</span><span class="o">-</span><span class="mf">250.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">130.0</span><span class="p">),</span>  <span class="c1"># Y, mm</span>
        <span class="p">(</span><span class="mf">300.0</span><span class="p">,</span> <span class="mf">400.0</span><span class="p">),</span>  <span class="c1"># Z, mm</span>
    <span class="p">)</span>
    <span class="n">grid_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">40.0</span>
    <span class="n">tool_orientation</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">180.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">)</span>
    <span class="n">charuco_xml</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">CAMERA_INTR</span> <span class="o">/</span> <span class="s2">&quot;charuco_cam.xml&quot;</span><span class="p">)</span>
    <span class="n">calib_output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">RESULTS_DIR</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="utils.HandEyeCfg" class="doc doc-heading">
            <code>HandEyeCfg</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Hand-eye calibration configuration parameters.
Includes Charuco board parameters, allowed outliers,
min corners, input/output paths, etc.</p>







              <details class="quote">
                <summary>Source code in <code>utils/settings.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HandEyeCfg</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hand-eye calibration configuration parameters.</span>
<span class="sd">    Includes Charuco board parameters, allowed outliers,</span>
<span class="sd">    min corners, input/output paths, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">square_numbers</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">square_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.031</span>
    <span class="n">marker_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.023</span>
    <span class="n">CHARUCO_DICT_MAP</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;5X5_50&quot;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">aruco</span><span class="o">.</span><span class="n">DICT_5X5_50</span><span class="p">,</span>
        <span class="s2">&quot;5X5_100&quot;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">aruco</span><span class="o">.</span><span class="n">DICT_5X5_100</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">aruco_dict</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;5X5_100&quot;</span>
    <span class="n">min_corners</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">outlier_std</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>
    <span class="n">analyze_corners</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">visualize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">robot_poses_file</span> <span class="o">=</span> <span class="n">paths</span><span class="o">.</span><span class="n">CAPTURES_EXTR_DIR</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.json&quot;</span><span class="p">)</span>  <span class="c1"># &#39;calib/*.json&#39;</span>
    <span class="n">images_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">CAPTURES_DIR</span><span class="p">)</span>
    <span class="n">charuco_xml</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">CAMERA_INTR</span> <span class="o">/</span> <span class="s2">&quot;charuco_cam.xml&quot;</span><span class="p">)</span>
    <span class="n">charuco_txt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">CAMERA_INTR</span> <span class="o">/</span> <span class="s2">&quot;charuco_cam.txt&quot;</span><span class="p">)</span>
    <span class="n">calib_output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">RESULTS_DIR</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="utils.JSONPoseLoader" class="doc doc-heading">
            <code>JSONPoseLoader</code>


</h2>


    <div class="doc doc-contents ">


        <p>Load robot poses for hand-eye calibration from a JSON file.</p>







              <details class="quote">
                <summary>Source code in <code>utils/io.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">JSONPoseLoader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load robot poses for hand-eye calibration from a JSON file.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_poses</span><span class="p">(</span><span class="n">json_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return rotation and translation lists from ``json_file``.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
        <span class="n">Rs</span><span class="p">,</span> <span class="n">ts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pose</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">tcp_pose</span> <span class="o">=</span> <span class="n">pose</span><span class="p">[</span><span class="s2">&quot;tcp_coords&quot;</span><span class="p">]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tcp_pose</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span>
            <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rz</span> <span class="o">=</span> <span class="n">tcp_pose</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
            <span class="n">R_mat</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_euler</span><span class="p">(</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rz</span><span class="p">],</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
            <span class="n">Rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R_mat</span><span class="p">)</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Rs</span><span class="p">,</span> <span class="n">ts</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="utils.JSONPoseLoader.load_poses" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_poses</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return rotation and translation lists from <code>json_file</code>.</p>


            <details class="quote">
              <summary>Source code in <code>utils/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_poses</span><span class="p">(</span><span class="n">json_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return rotation and translation lists from ``json_file``.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
    <span class="n">Rs</span><span class="p">,</span> <span class="n">ts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pose</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">tcp_pose</span> <span class="o">=</span> <span class="n">pose</span><span class="p">[</span><span class="s2">&quot;tcp_coords&quot;</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tcp_pose</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rz</span> <span class="o">=</span> <span class="n">tcp_pose</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="n">R_mat</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_euler</span><span class="p">(</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rz</span><span class="p">],</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
        <span class="n">Rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R_mat</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Rs</span><span class="p">,</span> <span class="n">ts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="utils.Logger" class="doc doc-heading">
            <code>Logger</code>


</h2>


    <div class="doc doc-contents ">


        <p>Project-wide logger wrapper using loguru and global config.</p>







              <details class="quote">
                <summary>Source code in <code>utils/logger.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Logger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Project-wide logger wrapper using loguru and global config.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_configure</span><span class="p">(</span><span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">json_format</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure log sinks on first use.&quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">_is_configured</span><span class="p">,</span> <span class="n">_log_file</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">_log_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
        <span class="n">_log_file</span> <span class="o">=</span> <span class="n">_log_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.log.json&quot;</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span>
            <span class="n">serialize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="n">LOGCFG</span><span class="o">.</span><span class="n">log_format</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">_log_file</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span>
            <span class="n">serialize</span><span class="o">=</span><span class="n">json_format</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="n">LOGCFG</span><span class="o">.</span><span class="n">log_file_format</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_is_configured</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_logger</span><span class="p">(</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">json_format</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoguruLogger</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a configured loguru logger bound to ``name``.</span>
<span class="sd">        If level or json_format are not specified, uses global config.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">_is_configured</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_configured</span><span class="p">:</span>
            <span class="n">Logger</span><span class="o">.</span><span class="n">_configure</span><span class="p">(</span>
                <span class="n">level</span> <span class="ow">or</span> <span class="n">LOGCFG</span><span class="o">.</span><span class="n">level</span><span class="p">,</span>
                <span class="n">json_format</span> <span class="k">if</span> <span class="n">json_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">LOGCFG</span><span class="o">.</span><span class="n">json</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">_logger</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">progress</span><span class="p">(</span>
        <span class="n">iterable</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
        <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">total</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a tqdm iterator with unified style.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span>
            <span class="n">Iterable</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
            <span class="n">tqdm</span><span class="p">(</span>
                <span class="n">iterable</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
                <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
                <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">bar_format</span><span class="o">=</span><span class="n">LOGCFG</span><span class="o">.</span><span class="n">progress_bar_format</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">configure_root_logger</span><span class="p">(</span><span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure the root logger for third-party libraries.&quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">_is_configured</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
        <span class="n">_is_configured</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">json_format</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Manually configure the logger with given settings.&quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">_log_dir</span>
        <span class="n">_log_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">log_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">log_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">LOGCFG</span><span class="o">.</span><span class="n">log_dir</span>
        <span class="n">Logger</span><span class="o">.</span><span class="n">_configure</span><span class="p">(</span>
            <span class="n">level</span> <span class="ow">or</span> <span class="n">LOGCFG</span><span class="o">.</span><span class="n">level</span><span class="p">,</span>
            <span class="n">json_format</span> <span class="k">if</span> <span class="n">json_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">LOGCFG</span><span class="o">.</span><span class="n">json</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="utils.Logger.configure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">configure</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json_format</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Manually configure the logger with given settings.</p>


            <details class="quote">
              <summary>Source code in <code>utils/logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span>
    <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">json_format</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manually configure the logger with given settings.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_log_dir</span>
    <span class="n">_log_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">log_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">log_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">LOGCFG</span><span class="o">.</span><span class="n">log_dir</span>
    <span class="n">Logger</span><span class="o">.</span><span class="n">_configure</span><span class="p">(</span>
        <span class="n">level</span> <span class="ow">or</span> <span class="n">LOGCFG</span><span class="o">.</span><span class="n">level</span><span class="p">,</span>
        <span class="n">json_format</span> <span class="k">if</span> <span class="n">json_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">LOGCFG</span><span class="o">.</span><span class="n">json</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="utils.Logger.configure_root_logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">configure_root_logger</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;WARNING&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Configure the root logger for third-party libraries.</p>


            <details class="quote">
              <summary>Source code in <code>utils/logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">configure_root_logger</span><span class="p">(</span><span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure the root logger for third-party libraries.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_is_configured</span>
    <span class="n">_logger</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
    <span class="n">_logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
    <span class="n">_is_configured</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="utils.Logger.get_logger" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_logger</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json_format</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return a configured loguru logger bound to <code>name</code>.
If level or json_format are not specified, uses global config.</p>


            <details class="quote">
              <summary>Source code in <code>utils/logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_logger</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">json_format</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoguruLogger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a configured loguru logger bound to ``name``.</span>
<span class="sd">    If level or json_format are not specified, uses global config.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_is_configured</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_configured</span><span class="p">:</span>
        <span class="n">Logger</span><span class="o">.</span><span class="n">_configure</span><span class="p">(</span>
            <span class="n">level</span> <span class="ow">or</span> <span class="n">LOGCFG</span><span class="o">.</span><span class="n">level</span><span class="p">,</span>
            <span class="n">json_format</span> <span class="k">if</span> <span class="n">json_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">LOGCFG</span><span class="o">.</span><span class="n">json</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">_logger</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="utils.Logger.progress" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">progress</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return a tqdm iterator with unified style.</p>


            <details class="quote">
              <summary>Source code in <code>utils/logger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">progress</span><span class="p">(</span>
    <span class="n">iterable</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
    <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">total</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a tqdm iterator with unified style.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span>
        <span class="n">Iterable</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
        <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">iterable</span><span class="p">,</span>
            <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
            <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">bar_format</span><span class="o">=</span><span class="n">LOGCFG</span><span class="o">.</span><span class="n">progress_bar_format</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="utils.TransformUtils" class="doc doc-heading">
            <code>TransformUtils</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Utility class for chaining and applying transformations.</p>







              <details class="quote">
                <summary>Source code in <code>utils/geometry.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TransformUtils</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Utility class for chaining and applying transformations.&quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa: D401</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="ow">or</span> <span class="n">Logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;utils.transform&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">build_transform</span><span class="p">(</span><span class="n">R</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">make_transform</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_transform</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">make_transform</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">points_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">points</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">T</span> <span class="o">@</span> <span class="n">points_h</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">chain_transforms</span><span class="p">(</span><span class="o">*</span><span class="n">Ts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">T_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">Ts</span><span class="p">:</span>
            <span class="n">T_out</span> <span class="o">=</span> <span class="n">T_out</span> <span class="o">@</span> <span class="n">T</span>
        <span class="k">return</span> <span class="n">T_out</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying transform to </span><span class="si">{</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> points&quot;</span><span class="p">)</span>
        <span class="n">points_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">points</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))])</span>
        <span class="n">transformed</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span> <span class="o">@</span> <span class="n">points_h</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Transformed points sample: </span><span class="si">{</span><span class="n">transformed</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">transformed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">base_to_tcp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">tcp_pose</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tcp_pose</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tcp_pose</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">tcp_pose</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tcp_pose</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tcp_pose</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">R</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">tcp_pose</span>
            <span class="k">return</span> <span class="n">make_transform</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tcp_pose must be SE(3) 4x4 or (R, t)&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">tool_to_tcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tcp_offset</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tcp_offset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">tcp_offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rz</span> <span class="o">=</span> <span class="n">tcp_offset</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">euler_to_matrix</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rz</span><span class="p">,</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">make_transform</span><span class="p">(</span><span class="n">rot</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">tcp_to_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R_handeye</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">t_handeye</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">make_transform</span><span class="p">(</span><span class="n">R_handeye</span><span class="p">,</span> <span class="n">t_handeye</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_base_to_camera</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tcp_pose</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">tcp_offset</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">R_handeye</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">t_handeye</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">T_base_tcp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_to_tcp</span><span class="p">(</span><span class="n">tcp_pose</span><span class="p">)</span>
        <span class="n">T_tcp_tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_to_tcp</span><span class="p">(</span><span class="n">tcp_offset</span><span class="p">)</span>
        <span class="n">T_tool_cam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcp_to_camera</span><span class="p">(</span><span class="n">R_handeye</span><span class="p">,</span> <span class="n">t_handeye</span><span class="p">)</span>
        <span class="n">T_base_cam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_transforms</span><span class="p">(</span><span class="n">T_base_tcp</span><span class="p">,</span> <span class="n">T_tcp_tool</span><span class="p">,</span> <span class="n">T_tool_cam</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computed T_baseâ†’camera&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">T_base_cam</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">camera_to_world</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">points_cam</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">T_base_cam</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Transforming points: camera â†’ world&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">points_cam</span><span class="p">,</span> <span class="n">T_base_cam</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">world_to_camera</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">points_world</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">T_base_cam</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Transforming points: world â†’ camera&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">points_world</span><span class="p">,</span> <span class="n">invert_transform</span><span class="p">(</span><span class="n">T_base_cam</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">camera_to_tcp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">points_cam</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">R_handeye</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">t_handeye</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcp_to_camera</span><span class="p">(</span><span class="n">R_handeye</span><span class="p">,</span> <span class="n">t_handeye</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">points_cam</span><span class="p">,</span> <span class="n">invert_transform</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">tcp_to_camera_points</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">points_tcp</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">R_handeye</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">t_handeye</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcp_to_camera</span><span class="p">(</span><span class="n">R_handeye</span><span class="p">,</span> <span class="n">t_handeye</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">points_tcp</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="utils.decompose_transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decompose_transform</span><span class="p">(</span><span class="n">T</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Return rotation matrix and translation vector from a transform.</p>


            <details class="quote">
              <summary>Source code in <code>utils/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decompose_transform</span><span class="p">(</span><span class="n">T</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return rotation matrix and translation vector from a transform.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="utils.euler_to_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">euler_to_matrix</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rz</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Return a rotation matrix from Euler angles.</p>


            <details class="quote">
              <summary>Source code in <code>utils/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">euler_to_matrix</span><span class="p">(</span>
    <span class="n">rx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">ry</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">rz</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">degrees</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a rotation matrix from Euler angles.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_euler</span><span class="p">(</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rz</span><span class="p">],</span> <span class="n">degrees</span><span class="o">=</span><span class="n">degrees</span><span class="p">)</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="utils.invert_transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">invert_transform</span><span class="p">(</span><span class="n">T</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Return the inverse of a homogeneous transform.</p>


            <details class="quote">
              <summary>Source code in <code>utils/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">invert_transform</span><span class="p">(</span><span class="n">T</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the inverse of a homogeneous transform.&quot;&quot;&quot;</span>
    <span class="n">R</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">decompose_transform</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="n">R_inv</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span>
    <span class="n">t_inv</span> <span class="o">=</span> <span class="o">-</span><span class="n">R_inv</span> <span class="o">@</span> <span class="n">t</span>
    <span class="k">return</span> <span class="n">make_transform</span><span class="p">(</span><span class="n">R_inv</span><span class="p">,</span> <span class="n">t_inv</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="utils.load_camera_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_camera_params</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Read camera matrix and distortion coefficients from OpenCV XML/YAML.</p>


            <details class="quote">
              <summary>Source code in <code>utils/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_camera_params</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read camera matrix and distortion coefficients from OpenCV XML/YAML.&quot;&quot;&quot;</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FileStorage</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FILE_STORAGE_READ</span><span class="p">)</span>
    <span class="n">camera_matrix</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;camera_matrix&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mat</span><span class="p">()</span>
    <span class="n">dist_coeffs</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;dist_coeffs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mat</span><span class="p">()</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">camera_matrix</span><span class="p">,</span> <span class="n">dist_coeffs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="utils.load_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_json</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Load JSON data from <code>path</code>.</p>


            <details class="quote">
              <summary>Source code in <code>utils/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_json</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load JSON data from ``path``.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="utils.load_npy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_npy</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Load an <code>.npy</code> array.</p>


            <details class="quote">
              <summary>Source code in <code>utils/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_npy</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load an ``.npy`` array.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="utils.make_transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_transform</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Build a homogeneous transform from <code>R</code> and <code>t</code>.</p>


            <details class="quote">
              <summary>Source code in <code>utils/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_transform</span><span class="p">(</span><span class="n">R</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build a homogeneous transform from ``R`` and ``t``.&quot;&quot;&quot;</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span>
    <span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">T</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="utils.read_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_image</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Return an image from <code>path</code> or <code>None</code> if loading fails.</p>


            <details class="quote">
              <summary>Source code in <code>utils/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_image</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return an image from ``path`` or ``None`` if loading fails.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="utils.save_camera_params_txt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_camera_params_txt</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">rms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Write camera parameters to a text file.</p>


            <details class="quote">
              <summary>Source code in <code>utils/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_camera_params_txt</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">K</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">dist</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">rms</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write camera parameters to a text file.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMS Error: </span><span class="si">{</span><span class="n">rms</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;camera_matrix =</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.10f</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;dist_coeffs =</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.10f</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="utils.save_camera_params_xml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_camera_params_xml</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Write camera parameters to an XML/YAML file.</p>


            <details class="quote">
              <summary>Source code in <code>utils/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_camera_params_xml</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">K</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">dist</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write camera parameters to an XML/YAML file.&quot;&quot;&quot;</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FileStorage</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FILE_STORAGE_WRITE</span><span class="p">)</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;camera_matrix&quot;</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;dist_coeffs&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="utils.save_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_json</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Write data as JSON to <code>path</code>.</p>


            <details class="quote">
              <summary>Source code in <code>utils/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_json</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write data as JSON to ``path``.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="utils.save_npy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_npy</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Save an array to an <code>.npy</code> file.</p>


            <details class="quote">
              <summary>Source code in <code>utils/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_npy</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save an array to an ``.npy`` file.&quot;&quot;&quot;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="utils.write_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_image</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Save an image to disk.</p>


            <details class="quote">
              <summary>Source code in <code>utils/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_image</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save an image to disk.&quot;&quot;&quot;</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>